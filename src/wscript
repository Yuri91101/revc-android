#! /usr/bin/env python
# encoding: utf-8

from waflib import Utils
import os, subprocess

top = '.'
PROJECT_NAME = 'src'

def options(opt):
	# stub
	return

def configure(conf):
	conf.env.append_unique('DEFINES',[
		'RW_GL3',
		'LIBRW_SDL2',
		'LIBRW',
		'AUDIO_OAL',
		'USE_OUR_VERSIONING'
	])
	git_sha1 = subprocess.check_output(['git', 'rev-parse', '--short', 'HEAD']).strip()
	sha1_text = f'#define GIT_SHA1 "{git_sha1.decode("utf-8")}"'
	with open("src/extras/GitSHA1.cpp", "w") as cpp_file:
		cpp_file.write(sha1_text + '\nconst char* g_GIT_SHA1 = GIT_SHA1;')
	cpp_file.close()


def build(bld):
	source = [
        'entities/Entity.cpp',
        'entities/Dummy.cpp',
        'entities/Physical.cpp',
        'math/math.cpp',
        'math/Vector.cpp',
        'math/Rect.cpp',
        'math/Matrix.cpp',
        'math/Quaternion.cpp',
        'vehicles/Transmission.cpp',
        'vehicles/Plane.cpp',
        'vehicles/Door.cpp',
        'vehicles/Floater.cpp',
        'vehicles/Cranes.cpp',
        'vehicles/HandlingMgr.cpp',
        'vehicles/Boat.cpp',
        'vehicles/CarGen.cpp',
        'vehicles/Vehicle.cpp',
        'vehicles/Heli.cpp',
        'vehicles/Bike.cpp',
        'vehicles/Train.cpp',
        'vehicles/DamageManager.cpp',
        'vehicles/Automobile.cpp',
        'peds/PedType.cpp',
        'peds/PedPlacement.cpp',
        'peds/PedAI.cpp',
        'peds/CivilianPed.cpp',
        'peds/PedIK.cpp',
        'peds/PedFight.cpp',
        'peds/PedChat.cpp',
        'peds/Gangs.cpp',
        'peds/PedDebug.cpp',
        'peds/EmergencyPed.cpp',
        'peds/PedRoutes.cpp',
        'peds/Ped.cpp',
        'peds/Population.cpp',
        'peds/PedAttractor.cpp',
        'peds/PlayerPed.cpp',
        'peds/CopPed.cpp',
        'fakerw/fake.cpp',
        'renderer/Timecycle.cpp',
        'renderer/PointLights.cpp',
        'renderer/MBlur.cpp',
        'renderer/Sprite2d.cpp',
        'renderer/Weather.cpp',
        'renderer/WaterCannon.cpp',
        'renderer/Skidmarks.cpp',
        'renderer/WaterLevel.cpp',
        'renderer/WaterCreatures.cpp',
        'renderer/Antennas.cpp',
        'renderer/SpecialFX.cpp',
        'renderer/RenderBuffer.cpp',
        'renderer/Glass.cpp',
        'renderer/Fluff.cpp',
        'renderer/Occlusion.cpp',
        'renderer/ShadowCamera.cpp',
        'renderer/Credits.cpp',
        'renderer/Coronas.cpp',
        'renderer/PlayerSkin.cpp',
        'renderer/VarConsole.cpp',
        'renderer/CutsceneShadow.cpp',
        'renderer/Instance.cpp',
        'renderer/Clouds.cpp',
        'renderer/Shadows.cpp',
        'renderer/Hud.cpp',
        'renderer/Draw.cpp',
        'renderer/Rubbish.cpp',
        'renderer/Particle.cpp',
        'renderer/Sprite.cpp',
        'renderer/WindModifiers.cpp',
        'renderer/Console.cpp',
        'renderer/Font.cpp',
        'renderer/Renderer.cpp',
        'renderer/TexList.cpp',
        'renderer/ParticleMgr.cpp',
        'renderer/Lines.cpp',
        'weapons/ShotInfo.cpp',
        'weapons/WeaponInfo.cpp',
        'weapons/Weapon.cpp',
        'weapons/WeaponEffects.cpp',
        'weapons/ProjectileInfo.cpp',
        'weapons/Explosion.cpp',
        'weapons/BulletInfo.cpp',
        'modelinfo/PedModelInfo.cpp',
        'modelinfo/VehicleModelInfo.cpp',
        'modelinfo/ModelIndices.cpp',
        'modelinfo/WeaponModelInfo.cpp',
        'modelinfo/BaseModelInfo.cpp',
        'modelinfo/ClumpModelInfo.cpp',
        'modelinfo/TimeModelInfo.cpp',
        'modelinfo/ModelInfo.cpp',
        'modelinfo/SimpleModelInfo.cpp',
        'modelinfo/MloModelInfo.cpp',
        'extras/custompipes.cpp',
        'extras/screendroplets.cpp',
        'extras/postfx.cpp',
        'extras/custompipes_d3d9.cpp',
        'extras/custompipes_gl.cpp',
        'extras/frontendoption.cpp',
        'extras/debugmenu.cpp',
        'extras/GitSHA1.cpp',
        'audio/sampman_miles.cpp',
        'audio/eax/eax-util.cpp',
        'audio/AudioScriptObject.cpp',
        'audio/MusicManager.cpp',
        'audio/AudioCollision.cpp',
        'audio/AudioManager.cpp',
        'audio/DMAudio.cpp',
        'audio/PolRadio.cpp',
        'audio/oal/channel.cpp',
        'audio/oal/stream.cpp',
        'audio/oal/aldlist.cpp',
        'audio/oal/oal_utils.cpp',
        'audio/sampman_null.cpp',
        'audio/AudioLogic.cpp',
        'audio/sampman_oal.cpp',
        'text/Text.cpp',
        'text/Pager.cpp',
        'text/Messages.cpp',
        'skel/crossplatform.cpp',
        'skel/win/win.cpp',
        'skel/skeleton.cpp',
        'skel/events.cpp',
        'skel/glfw/glfw.cpp',
        'skel/sdl2.cpp',
        'collision/TempColModels.cpp',
        'collision/ColModel.cpp',
        'collision/VuCollision.cpp',
        'collision/ColTriangle.cpp',
        'collision/ColStore.cpp',
        'collision/ColPoint.cpp',
        'collision/ColLine.cpp',
        'collision/Collision.cpp',
        'collision/ColSphere.cpp',
        'collision/ColBox.cpp',
        'buildings/Treadable.cpp',
        'buildings/Building.cpp',
        'objects/ParticleObject.cpp',
        'objects/Projectile.cpp',
        'objects/DummyObject.cpp',
        'objects/Stinger.cpp',
        'objects/ObjectData.cpp',
        'objects/CutsceneObject.cpp',
        'objects/Object.cpp',
        'rw/Lights.cpp',
        'rw/VisibilityPlugins.cpp',
        'rw/NodeName.cpp',
        'rw/RwPS2AlphaTest.cpp',
        'rw/RwHelper.cpp',
        'rw/ClumpRead.cpp',
        'rw/MemoryMgr.cpp',
        'rw/RwMatFX.cpp',
        'rw/TexturePools.cpp',
        'rw/TxdStore.cpp',
        'rw/MemoryHeap.cpp',
        'rw/TexRead.cpp',
        'core/SurfaceTable.cpp',
        'core/main.cpp',
        'core/PlayerInfo.cpp',
        'core/Zones.cpp',
        'core/EventList.cpp',
        'core/IniFile.cpp',
        'core/Frontend.cpp',
        'core/Timer.cpp',
        'core/Fire.cpp',
        'core/timebars.cpp',
        'core/FileLoader.cpp',
        'core/AnimViewer.cpp',
        'core/Profile.cpp',
        'core/FrontEndControls.cpp',
        'core/MenuScreensCustom.cpp',
        'core/MenuScreens.cpp',
        'core/Stats.cpp',
        'core/Game.cpp',
        'core/CdStreamPosix.cpp',
        'core/World.cpp',
        'core/Camera.cpp',
        'core/TimeStep.cpp',
        'core/Pools.cpp',
        'core/FileMgr.cpp',
        'core/User.cpp',
        'core/Placeable.cpp',
        'core/Wanted.cpp',
        'core/References.cpp',
        'core/Ropes.cpp',
        'core/ZoneCull.cpp',
        'core/Range2D.cpp',
        'core/Streaming.cpp',
        'core/Range3D.cpp',
        'core/CdStream.cpp',
        'core/Debug.cpp',
        'core/Pad.cpp',
        'core/Frontend_PS2.cpp',
        'core/re3.cpp',
        'core/Accident.cpp',
        'core/Radar.cpp',
        'core/Clock.cpp',
        'core/Lists.cpp',
        'core/Cam.cpp',
        'core/obrstr.cpp',
        'core/Directory.cpp',
        'core/ControllerConfig.cpp',
        'animation/AnimBlendAssociation.cpp',
        'animation/AnimBlendNode.cpp',
        'animation/FrameUpdate.cpp',
        'animation/AnimBlendAssocGroup.cpp',
        'animation/AnimBlendClumpData.cpp',
        'animation/Bones.cpp',
        'animation/AnimBlendHierarchy.cpp',
        'animation/CutsceneMgr.cpp',
        'animation/AnimManager.cpp',
        'animation/RpAnimBlend.cpp',
        'animation/AnimBlendSequence.cpp',
        'control/Script2.cpp',
        'control/Record.cpp',
        'control/Darkel.cpp',
        'control/NameGrid.cpp',
        'control/Remote.cpp',
        'control/Script7.cpp',
        'control/PowerPoints.cpp',
        'control/Curves.cpp',
        'control/CarCtrl.cpp',
        'control/Replay.cpp',
        'control/RoadBlocks.cpp',
        'control/PathFind.cpp',
        'control/TrafficLights.cpp',
        'control/Pickups.cpp',
        'control/Script6.cpp',
        'control/Bridge.cpp',
        'control/Script.cpp',
        'control/CarAI.cpp',
        'control/Phones.cpp',
        'control/AutoPilot.cpp',
        'control/Script4.cpp',
        'control/OnscreenTimer.cpp',
        'control/Garages.cpp',
        'control/GameLogic.cpp',
        'control/Restart.cpp',
        'control/Script5.cpp',
        'control/Script8.cpp',
        'control/SceneEdit.cpp',
        'control/SetPieces.cpp',
        'control/Script3.cpp',
        'control/ScriptDebug.cpp',
        'save/Date.cpp',
        'save/MemoryCard.cpp',
        'save/GenericGameStorage.cpp',
        'save/PCSave.cpp',
	]
	includes = [
		'.',
		'core',
		'fakerw',
		'skel',
		'renderer',
		'math',
		'rw',
		'control',
		'buildings',
		'animation',
		'objects',
		'entities',
		'modelinfo',
		'weapons',
		'collision',
		'peds',
		'vehicles',
		'text',
		'audio',
		'../vendor/librw',
		'extras',
		'save',
		'audio/eax',
	]

	defines = []

	libs = ['OPENAL', 'MPG123', 'SNDFILE', 'GL', 'vendor/librw']

	
	install_path = bld.env.PREFIX

	bld(
		source   = source,
		target   = "revc",
		name	 = PROJECT_NAME,
		features = 'c cxx cxxprogram',
		includes = includes,
		defines  = defines,
		use	  = libs,
		subsystem = bld.env.MSVC_SUBSYSTEM,
		idx	  = bld.get_taskgen_count()
	)


